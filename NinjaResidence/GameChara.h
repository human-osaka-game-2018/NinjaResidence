/**
* @file GameChara.h
* @brief GameCharaクラス
* @author Kojiro Kawahara
*/
#pragma once

#include <vector>
#include "GAMESCENE.h"
#include "Object.h"
#include "MapChip.h"

class GameScene;
class MapReverse;
/**
* @namespace PlayerAnimation
* @author Toshiya Matsuoka
*/
namespace PlayerAnimation {
	enum MOTION {
		STANDBY,
		DASH,
		STAND,
		JUMPING,
		//! 壁掴まり
		WALLHOLD,
		THROWING,
	};
	enum DIRECTION {
		FACING_NOTHING = 0,
		//! param 1
		FACING_RIGHT = 1,
		//! param -1
		FACING_LEFT = -1,
	};
	//! アニメ用の仮列挙
	enum DIRECTION_BIAS {
		ZERO,
		ONE,
	};
};

class GameChara :public Object
{
public:
	int GetMapCharaPositionX() { return MapLeftDirectionPosition; }
	int GetMapCharaPositionY() { return MapCharaPositionY; }
	void prevSaveMapCharaPos();
	void KeyOperation(KeyInput vec);
	void CharaInforSave(int MapReverse1, Object* MapChip);
	void Update();
	void Render();
	GameChara(DirectX* pDirectX, SoundsManager* pSoundManager, Object* MapChip);
	~GameChara();
	/**
	* @brief Debug用キャラ上昇処理
	* @author Toshiya Matsuoka
	*/
	void DebugMove();

	/**
	* @brief キャラのディスプレイ上前端の取得
	* @author Toshiya Matsuoka
	*/
	float GetPositionX();
	/**
	* @brief キャラのディスプレイ上中心Y座標の取得
	* @author Toshiya Matsuoka
	*/
	float GetPositionY() {
		return m_DisplayCharaCoordinate[0].y + (CELL_SIZE * 2);
	}

	/**
	* @brief キャラの向いている方向の取得
	* @sa PlayerAnimation::DIRECTION
	* @author Toshiya Matsuoka
	*/
	PlayerAnimation::DIRECTION GetFacing() {
		return Facing;
	}
private:
	CENTRAL_STATE m_Player = { 400,200,(CELL_SIZE * 2),(CELL_SIZE * 4) };
	CUSTOMVERTEX m_DisplayCharaCoordinate[4];
	CUSTOMVERTEX m_WorldCharaCoordinate[4];
	CUSTOMVERTEX m_ReverseDisplayCharaCoordinate[4];
	CUSTOMVERTEX m_ReverseWorldCharaCoordinate[4];
	CUSTOMVERTEX m_SurfaceDisplayCharaCoordinate[4];
	CUSTOMVERTEX m_SurfaceWorldCharaCoordinate[4];

	int m_PrevMapLeftDirectionPosition;//前フレームのMapLeftDirectionPositionの値
	int m_PrevMapRightDirectionPosition;//前フレームのMapRightDirectionPositionの値
	int m_PrevMapCharaPositionY;//前フレームのMapCharaPositionYの値
	int MapLeftDirectionPosition;//キャラの左側のX座標
	int MapRightDirectionPosition;//キャラの右側のX座標
	int MapCharaPositionY;//キャラの上側のx座標
	const float Gravity = 15.f;//毎フレームかける重力の値
	const float CharaMoveSpeed = 15.f;
	const float VerticalScrollingLevel = 5.f;

	const int DisplayCharMoveScopeUp = 100;//m_DisplayCharaCoordinateのY座標がこの値を下回ると上にスクロールする
	const int DisplayCharMoveScopeDown = 630;//m_DisplayCharaCoordinateのY座標がこの値を超えると上にスクロールする
	const int DisplayCharMoveScopeLeft = 300;//m_DisplayCharaCoordinateのX座標がこの値を下回ると左にスクロールする
	const int DisplayCharMoveScopeRight = 980;//m_DisplayCharaCoordinateのX座標がこの値を超えると右にスクロールする
	const int DisplayCharMoveScopeX = 300;//両端からのX座標の稼働範囲

	MapReverse* m_pMapReverse = NULL;
	Object* m_pMapChip = NULL;
	float CharTu = 80 / 512.f;
	float CharTv = 160 / 512.f;

	//仮統合ファイルの切り取り情報
	float TESTCharTu = 233 / 2048.f;
	float TESTCharTv = 215 / 2048.f;
	float TESTCharBias = 64 / 2024.f;

	PlayerAnimation::MOTION ChangeAnimation = PlayerAnimation::STAND;
	PlayerAnimation::DIRECTION Facing = PlayerAnimation::FACING_RIGHT;
	//! 仮置き変数
	PlayerAnimation::DIRECTION_BIAS Bias = PlayerAnimation::ZERO;


	bool isScrollingDown = false;
	bool isInTheAir = false;
	bool isJump = false;
	bool HeldOntoWallLeft = false;
	bool HeldOntoWallRight = false;
	bool CollisionHead = false;

	int RiseFlameTime = 0;
	bool isJumpRight = false;
	bool isJumpLeft = false;

	const float InitialAcceleration = 60.0f;
	float AccelerationY = InitialAcceleration;
	float AccelerationX = CharaMoveSpeed * 1.5f;


	void CharaMoveOperation(KeyInput vec);
	void ValueAllSetCUSTOMVERTEX(CUSTOMVERTEX* Receive, CUSTOMVERTEX* Give);
	void MapScroolCheck();

	/**
	* @breaf ジャンプの起動
	* @return ジャンプが起動すればtrue
	* @author Toshiya Matsuoka
	*/
	bool PermitJumping();
	/**
	* @breaf ジャンプの動作
	* @author Toshiya Matsuoka
	*/
	void Jump();
	/**
	* @breaf 壁ジャンプ用横移動処理
	* @author Toshiya Matsuoka
	*/
	void JumpingLateralMotion();
	/**
	* @breaf ジャンプの動作変数の初期化
	* @author Toshiya Matsuoka
	*/
	void InitJumpParam();
	/**
	* @breaf ジャンプの上昇量調整
	* @author Toshiya Matsuoka
	*/
	void AccelarationControl();

	/**
	* @breaf 投擲アニメ処理
	* @author Toshiya Matsuoka
	*/
	void ThrowAnime();

	/**
	* @breaf 課重力処理
	* @author Toshiya Matsuoka
	*/
	void AddGravity();
	/**
	* @breaf 下に対する何かしらの当たり判定
	* @return 当たっていればtrue
	* @author Toshiya Matsuoka
	*/
	bool DownCollisionAnything(void);
	/**
	* @breaf 上に対する何かしらの当たり判定
	* @return 当たっていればtrue
	* @author Toshiya Matsuoka
	*/
	bool TopCollisionAnything(void);
	/**
	* @breaf 下方向に対する当たり判定
	* @param block 指定のブロック番号
	* @return 当たっていればtrue
	* @sa  MapBlock::BLOCKTYPE
	* @author Toshiya Matsuoka
	*/
	bool DownCollisionCheck(int block);
	/**
	* @breaf 上方向に対する当たり判定
	* @param block 指定のブロック番号
	* @return 当たっていればtrue
	* @sa  MapBlock::BLOCKTYPE
	* @author Toshiya Matsuoka
	*/
	bool TopCollisionCheck(int block);
	/**
	* @breaf 右方向に対する当たり判定
	* @param block 指定のブロック番号
	* @return 当たっていればtrue
	* @sa  MapBlock::BLOCKTYPE
	* @author Toshiya Matsuoka
	*/
	bool RightCollisionCheck(int block);
	/**
	* @breaf 左方向に対する当たり判定
	* @param block 指定のブロック番号
	* @return 当たっていればtrue
	* @sa  MapBlock::BLOCKTYPE
	* @author Toshiya Matsuoka
	*/
	bool LeftCollisionCheck(int block);
};
